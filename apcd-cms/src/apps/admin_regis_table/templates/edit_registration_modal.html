{% load static %}
<link rel="stylesheet" href="{% static 'registrations/css/submission_form.css' %}">


<div id="editRegistrationModal_{{r.reg_id}}" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Edit Registration</h4>
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&#xe912;</span>
        </button>
      </div>
      <div class="modal-body">
        <div>
          <form action="" method="POST">
            {% csrf_token %}
            <input type="hidden" name="edit-registration-form" value>
            <input type="hidden" name="reg_id" value="{{r.reg_id}}">

            <h4>Organization</h4>
            <div class="form-errors" style="display: none"></div>

            <div class="field-wrapper radioselect required">
              <div class="field-errors" style="display: none"></div>

              <label>
                On behalf of:<span class="asterisk">*</span>
              </label>

              <ul id="on-behalf-of" class="radioselect">
                <li>
                  <label for="on-behalf-of_0"
                    ><input
                      type="radio"
                      name="on-behalf-of"
                      value="true"
                      class="radioselect"
                      required
                      id="on-behalf-of_0"
                      {% if r.view_modal_content.for_self %}
                        checked
                      {% endif %}
                    >
                    Self</label
                  >
                </li>
                <li>
                  <label for="on-behalf-of_1"
                    ><input
                      type="radio"
                      name="on-behalf-of"
                      value="false"
                      class="radioselect"
                      required
                      id="on-behalf-of_1"
                      {% if not r.view_modal_content.for_self %}
                        checked
                      {% endif %}
                    />
                    Other</label
                  >
                </li>
              </ul>
              </div>
              <div class="field-wrapper select required">
                <div class="field-errors" style="display: none"></div>
  
                <label for="type"> Type<span class="asterisk">*</span> </label>
  
                <select
                  name="type"
                  required="required"
                  class="choicefield"
                  id="type"
                >
                  {% for type, display_text in r.view_modal_content.org_types.items %}
                    <option value="{{ type|lower }}" {% if type == r.view_modal_content.type %}selected{% endif %}>
                      {{display_text}}
                    </option>
                  {% endfor %}
                </select>
              </div>
              <div class="field-wrapper textinput required">
                <div class="field-errors" style="display: none"></div>
  
                <label for="business-name">
                  Business Name<span class="asterisk">*</span>
                </label>
  
                <input
                  type="text"
                  name="business-name"
                  required
                  class="textinput"
                  id="business-name"
                  value="{{r.view_modal_content.biz_name}}"
                />
              </div>
              <div class="field-wrapper textinput required">
                <div class="field-errors" style="display: none"></div>
  
                <label for="mailing-address">
                  Mailing Address<span class="asterisk">*</span>
                </label>
  
                <input
                  type="text"
                  name="mailing-address"
                  required
                  class="textinput"
                  id="mailing-address"
                  value="{{r.view_modal_content.address}}"
                />
              </div>
              <div class="field-wrapper textinput required">
                <div class="field-errors" style="display: none"></div>
  
                <label for="city"> City<span class="asterisk">*</span> </label>
  
                <input
                  type="text"
                  name="city"
                  required
                  class="textinput"
                  id="city"
                  value="{{r.view_modal_content.city}}"
                />
              </div>
              <div class="field-wrapper select required">
                <div class="field-errors" style="display: none"></div>
  
                <label for="state"> State<span class="asterisk">*</span> </label>
  
                <select
                  name="state"
                  required="required"
                  class="choicefield"
                  id="state"
                >
                  {% for state in r.view_modal_content.us_state_list %}
                    <option value="{{ state }}" {% if r.view_modal_content.state == state|slice:":2" %}selected{% endif %}>
                      {{ state }}
                    </option>
                  {% endfor %}
                </select>
              </div>
              <div class="field-wrapper textinput required">
                <div class="field-errors" style="display: none"></div>
  
                <label for="zip_code">
                  Zip Code<span class="asterisk">*</span>
                </label>
  
                <input
                  type="text"
                  name="zip_code"
                  required
                  class="textinput"
                  id="zip_code"
                  inputmode="numeric"
                  minlength="5"
                  maxlength="10"
                  pattern="\d{5}(-\d{4})?"
                  value="{{ r.view_modal_content.zip|cut:' ' }}"
                />
              </div>
            <hr>
            <h4>File Submission</h4>
            <div class="field-wrapper required">
              <label>
                Types of Files<span class="asterisk">*</span>
              </label>
              <!--<div class="help-text">
                Eligibility/Enrollment files are mandatory. Select additional file types to be submitted.
              </div>-->
            </div>

            <div class="field-wrapper checkboxselectmultiple required">
                <div class="field-errors" style="display: none"></div>

                <ul id="types_of_files" class="checkboxselectmultiple">
                  <li>
                    <label for="types_of_files_eligibility_enrollment"
                      ><input
                        type="checkbox"
                        name="types_of_files_eligibility_enrollment"
                        id="types_of_files_eligibility_enrollment"
                        checked=""
                        disabled
                      />Eligibility/Enrollment*</label
                    >
                  </li>
                  {% for file_type, file_type_selected in r.view_modal_content.files_type.items %}
                    {% if not forloop.first %}
                      <li>
                        <label for="types_of_files_{{ file_type|lower }}"
                          ><input
                            type="checkbox"
                            name="types_of_files_{{ file_type|lower }}"
                            id="types_of_files_{{ file_type|lower }}"
                            {% if file_type_selected %}checked{% endif %}
                          />{{ file_type }}</label
                        >
                      </li>
                    {% endif %}
                  {% endfor %}
                </ul>
              </div>
              <div class="field-wrapper required">
                <label
                  >Submission Method<span class="asterisk"
                    >*</span
                  >
                </label>
                <div class="help-text">
                  At least one of the following must be selected.
                </div>
              </div>
              <div class="field-wrapper checkboxselectmultiple required">
                <div class="field-errors" style="display: none"></div>

                <ul id="submission_method" class="checkboxselectmultiple">
                  {% for sub, display_value in r.view_modal_content.sub_methods.items %}
                    <li>
                      <label for="submission_method_{{ sub }}"
                        ><input
                          type="radio"
                          name="submission_method"
                          value="{{ display_value }}"
                          class="radioselect"
                          required
                          id="submission_method_{{ sub }}"
                          {{ r.view_modal_content.sub_method }}
                          {% if sub|upper == r.view_modal_content.sub_method %}checked{% endif %}
                        />{{ display_value }}</label
                      >
                    </li>
                  {% endfor %}
                </ul>
              </div>
            <hr>
            <h4>Entity/Entities Being Registered</h4>
            {% for entity in r.view_modal_content.entities %}
              <h4>Entity {{ forloop.counter }}</h4>
              <input type="hidden" name="ent_id_{{forloop.counter}}" value="{{entity.ent_id}}">
              <div class="field-wrapper textinput required">
                <div class="field-errors" style="display: none"></div>

                <label for="entity_name_{{forloop.counter}}_{{r.reg_id}}">
                  Name<span class="asterisk">*</span>
                </label>

                <input
                  type="text"
                  name="entity_name_{{forloop.counter}}_{{r.reg_id}}"
                  required
                  class="textinput"
                  id="entity_name_{{forloop.counter}}_{{r.reg_id}}"
                  value="{{ entity.ent_name }}"
                />
              </div>
              <div class="field-wrapper required">
                <label
                  >Number/Code<span class="asterisk">*</span>
                </label>
                <div class="help-text">
                  Provide all available identifiers. At least one of the following
                  is required.
                </div>
              </div>

              <div class="o-grid o-grid--col-auto-count">
                <div class="field-wrapper textinput">
                  <div class="field-errors" style="display: none"></div>

                  <label for="fein_{{forloop.counter}}_{{r.reg_id}}"> FEIN<sup>5</sup> </label>

                  <input
                    type="text"
                    name="fein_{{forloop.counter}}_{{r.reg_id}}"
                    placeholder="12-3456789"
                    class="textinput"
                    id="fein_{{forloop.counter}}_{{r.reg_id}}"
                    inputmode="numeric"
                    minlength="10"
                    maxlength="10"
                    pattern="\d{2}-\d{7}"
                    required
                    value="{{ entity.fein }}"
                  />

                  <div id="help-text-fein" class="help-text">
                    Enter in format <samp>12-3456789</samp>.
                  </div>
                </div>
                <div class="field-wrapper textinput">
                  <div class="field-errors" style="display: none"></div>

                  <label for="license_number_{{forloop.counter}}_{{r.reg_id}}"> License Number </label>

                  <input
                    type="text"
                    name="license_number_{{forloop.counter}}_{{r.reg_id}}"
                    placeholder="1234567890"
                    class="textinput"
                    id="license_number_{{forloop.counter}}_{{r.reg_id}}"
                    inputmode="numeric"
                    minlength="5"
                    maxlength="10"
                    pattern="\d{5}|\d{10}"
                    required
                    value="{{ entity.license }}"
                  />

                  <div id="help-text-license_number" class="help-text">
                    Enter a 5 or 10 digit number.
                  </div>
                </div>
                <div class="field-wrapper textinput">
                  <div class="field-errors" style="display: none"></div>

                  <label for="naic_company_code_{{forloop.counter}}_{{r.reg_id}}"> NAIC<sup>6</sup> Company Code </label>

                  <input
                    type="text"
                    name="naic_company_code_{{forloop.counter}}_{{r.reg_id}}"
                    placeholder="12345"
                    class="textinput"
                    id="naic_company_code_{{forloop.counter}}_{{r.reg_id}}"
                    inputmode="numeric"
                    minlength="5"
                    maxlength="5"
                    pattern="\d+"
                    required
                    value="{{ entity.naic }}"
                  />

                  <div id="help-text-naic_company_code" class="help-text">
                    Enter a 5 digit number.
                  </div>
                </div>
              </div>
              <h6>
                Coverage Estimates
                <small
                  >(Inclusive of all claims as of December 31 of previous
                  year.)</small
                >
              </h6>

              <div class="field-wrapper numberinput required">
                <div class="field-errors" style="display: none"></div>

                <label for="total_covered_lives_{{forloop.counter}}_{{r.reg_id}}">
                  Total Covered Lives<span class="asterisk">*</span>
                </label>

                <input
                  type="number"
                  name="total_covered_lives_{{forloop.counter}}_{{r.reg_id}}"
                  required
                  class="integerfield"
                  id="total_covered_lives_{{forloop.counter}}_{{r.reg_id}}"
                  inputmode="numeric"
                  min="1"
                  step="1"
                  value="{{ entity.no_covered }}"
                />
              </div>

              <div class="field-wrapper numberinput required">
                <div class="field-errors" style="display: none"></div>

                <label for="claims_encounters_volume_{{forloop.counter}}_{{r.reg_id}}">
                  Claims and Encounters Volume<span class="asterisk">*</span>
                </label>

                <input
                  type="number"
                  name="claims_encounters_volume_{{forloop.counter}}_{{r.reg_id}}"
                  required
                  class="integerfield"
                  id="claims_encounters_volume_{{forloop.counter}}_{{r.reg_id}}"
                  inputmode="numeric"
                  min="1"
                  value="{{ entity.claim_and_enc_vol }}"
                />
              </div>

              <div class="field-wrapper numberinput required s-affixed-input-wrapper s-affixed-input-wrapper--prefix">
                <div class="field-errors" style="display: none"></div>

                <label for="total_claims_value_{{forloop.counter}}_{{r.reg_id}}">
                  Total Claims Value (USD<sup>7</sup>)<span class="asterisk">*</span>
                </label>

                <span class="s-affixed-input-wrapper__prefix">$</span>
                <input
                  type="number"
                  name="total_claims_value_{{forloop.counter}}_{{r.reg_id}}"
                  required
                  class="integerfield"
                  id="total_claims_value_{{forloop.counter}}_{{r.reg_id}}"
                  inputmode="numeric"
                  step="0.01"
                  min="0.01"
                  value="{{ entity.claim_val }}"
                />
              </div>
            {% endfor %}
            {# Additional entities rendered here... #}
            {% with r.view_modal_content.entities|length as no_entities %}
              {% with no_entities|add:"-5"|cut:"-" as no_add_entities %}
                {% with ''|center:no_add_entities as range %}
                  {% for add_entity_no in range %}
                    {% with forloop.counter|add:no_entities as add_entity_no %}                    
                      <h4 id="entity_header_{{ add_entity_no }}_{{r.reg_id}}" style="display:none">Entity Information {{ add_entity_no }}</h4>
                      <div id="entity_block_{{ add_entity_no }}_{{r.reg_id}}"></div>
                    {% endwith %}
                  {% endfor %}
                {% endwith %}
              {% endwith %}
            {% endwith %}
            <button class="c-button c-button--primary" id="entity-add-btn-{{r.reg_id}}" type="button">+ Add Another Entity</button>
            <button class="c-button c-button--secondary" id="entity-drop-btn-{{r.reg_id}}" type="button">- Remove Last Entity</button>
            <hr>
            <h4>Contact Information</h4>
            {% for contact in r.view_modal_content.contacts %}
            <input type="hidden" name="cont_id_{{forloop.counter}}" value="{{contact.cont_id}}">
            <h5>Contact {{forloop.counter}}</h5>
              <div id="contact_block_{{ forloop.counter }}">
                <div class="field-wrapper textinput required">
                  <div class="field-errors" style="display: none"></div>
  
                  <label for="contact_type_{{forloop.counter}}_{{r.reg_id}}">
                    Role<span class="asterisk">*</span>
                  </label>
  
                  <input
                    type="text"
                    name="contact_type_{{forloop.counter}}_{{r.reg_id}}"
                    required
                    class="textinput"
                    id="contact_type_{{forloop.counter}}_{{r.reg_id}}"
                    value="{{ contact.role }}"
                  />
                </div>
                <div class="field-wrapper textinput required">
                  <div class="field-errors" style="display: none"></div>
  
                  <label for="contact_name_{{forloop.counter}}_{{r.reg_id}}"> Name<span class="asterisk">*</span> </label>
  
                  <input
                    type="text"
                    name="contact_name_{{forloop.counter}}_{{r.reg_id}}"
                    required
                    class="textinput"
                    id="contact_name_{{forloop.counter}}_{{r.reg_id}}"
                    value="{{ contact.name }}"
                  />
                </div>
                <div class="field-wrapper telephoneinput required">
                  <div class="field-errors" style="display: none"></div>
  
                  <label for="contact_phone_{{r.reg_id}}">
                    Phone<span class="asterisk">*</span>
                  </label>
  
                  <input
                    type="tel"
                    name="contact_phone_{{forloop.counter}}_{{r.reg_id}}"
                    required
                    class="telephoneinput"
                    id="contact_phone_{{forloop.counter}}_{{r.reg_id}}"
                    inputmode="tel"
                    pattern="^(\+0?1\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$"
                    value="{{ contact.phone }}"
                  />
  
                  <div id="help-text-contact_phone" class="help-text">
                    <details>
                      <summary>
                        <a
                          href="https://en.wikipedia.org/wiki/North_American_Numbering_Plan"
                          target="_blank"
                          >North American Numbering Plan</a
                        >
                        e.g. <samp>123 456-7890</samp>…
                      </summary>
                      <ul>
                        <li><samp>123-456-7890</samp></li>
                        <li><samp>(123) 456-7890</samp></li>
                        <li><samp>123 456 7890</samp></li>
                        <li><samp>123.456.7890</samp></li>
                        <li><samp>+1 (123) 456-7890</samp></li>
                      </ul>
                    </details>
                  </div>
                </div>
                <div class="field-wrapper emailinput required">
                  <div class="field-errors" style="display: none"></div>
  
                  <label for="contact_email_{{forloop.counter}}_{{r.reg_id}}">
                    Email<span class="asterisk">*</span>
                  </label>
  
                  <input
                    type="email"
                    name="contact_email_{{forloop.counter}}_{{r.reg_id}}"
                    autocomplete="email"
                    required
                    class="emailinput"
                    id="contact_email_{{forloop.counter}}_{{r.reg_id}}"
                    value="{{ contact.email }}"
                  />
                </div>
                <div class="field-wrapper checkboxinput">
                  <div class="field-errors" style="display: none"></div>
  
                  <input
                    type="checkbox"
                    name="contact_notifications_{{forloop.counter}}_{{r.reg_id}}"
                    class="booleanfield"
                    id="contact_notifications_{{forloop.counter}}_{{r.reg_id}}"
                    {% if contact.notif %}checked{% endif %}
                  />
  
                  <label for="contact_notifications_{{forloop.counter}}_{{r.reg_id}}">
                    Select to receive system notifications
                  </label>
                </div>
              </div>
            {% endfor %}
            {# Additional entities rendered here... #}
            {% with r.view_modal_content.contacts|length as no_contacts %}
              {% with no_contacts|add:"-5"|cut:"-" as no_add_contacts %}
                {% with ''|center:no_add_contacts as range %}
                  {% for add_contact_no in range %}
                    {% with forloop.counter|add:no_contacts as add_contact_no %}                    
                      <h4 id="contact_header_{{ add_contact_no }}_{{r.reg_id}}" style="display:none">Contact Information {{ add_contact_no }}</h4>
                      <div id="contact_block_{{ add_contact_no }}_{{r.reg_id}}"></div>
                    {% endwith %}
                  {% endfor %}
                {% endwith %}
              {% endwith %}
            {% endwith %}
            <button class="c-button c-button--primary" id="contact-add-btn-{{r.reg_id}}" type="button">+ Add Another Contact</button>
            <button class="c-button c-button--secondary" id="contact-drop-btn-{{r.reg_id}}" type="button">- Remove Last Contact</button>
            <div class="button-wrapper submit">
              <button class="form-button" type="submit" value="Submit">
                  Submit Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<aside>
  <!-- To let user add and remove entities -->
  {# RFE: Do not duplicate entity markup #}
  {# IDEA: HTML template for any instance; used by markup for 0, JS for 1+ #}
  <script id="form-add-remove-entity" type="module">
    const addEntityBtn = document.getElementById("entity-add-btn-{{r.reg_id}}");
    const dropEntityBtn = document.getElementById("entity-drop-btn-{{r.reg_id}}");
    const btnStatus = (() => {
      addEntityBtn.disabled = ( entities == 5 ? true : false );
      dropEntityBtn.disabled = ( entities == 1 ? true : false );
    });
    let entities = Number("{{ r.view_modal_content.entities|length }}");
    btnStatus();

    addEntityBtn.addEventListener("click", () => {
      if (entities < 5) entities += 1;
      let entityBlock = document.getElementById(`entity_block_${entities}_{{r.reg_id}}`);
      document.getElementById(`entity_header_${entities}_{{r.reg_id}}`).style.display = 'block';
      entityBlock.innerHTML = `
      <div class="field-wrapper textinput required">
        <div class="field-errors" style="display: none"></div>
        <label for="entity_name_${entities}_{{r.reg_id}}"> Name<span class="asterisk">*</span> </label>
        <input
          type="text"
          name="entity_name_${entities}_{{r.reg_id}}"
          required
          class="textinput"
          id="entity_name_${entities}_{{r.reg_id}}"
        />
        <div id="help-text-entity_name_${entities}" class="help-text">
        </div>
      </div>
      <div class="field-wrapper required">
        <label>
          Number/Code<span class="asterisk">*</span>
        </label>
        <div class="help-text">
          Provide all available identifiers. At least one of the following is
          required.
        </div>
      </div>
      <div class="o-grid o-grid--col-auto-count">
        <div class="field-wrapper textinput">
          <div class="field-errors" style="display: none"></div>
          <label for="fein_${entities}_{{r.reg_id}}"> FEIN<sup>5</sup> </label>
          <input
            type="text"
            name="fein_${entities}_{{r.reg_id}}"
            placeholder="12-3456789"
            class="textinput"
            id="fein_${entities}_{{r.reg_id}}"
            inputmode="numeric"
            minlength="10"
            maxlength="10"
            pattern="\\d{2}-\\d{7}"
            required
          />
          <div id="help-text-fein_${entities}" class="help-text">
            Enter in format <samp>12-3456789</samp>.
          </div>
        </div>
        <div class="field-wrapper textinput">
          <div class="field-errors" style="display: none"></div>
          <label for="license_number_${entities}_{{r.reg_id}}"> License Number </label>
          <input
            type="text"
            name="license_number_${entities}_{{r.reg_id}}"
            placeholder="1234567890"
            class="textinput"
            id="license_number_${entities}_{{r.reg_id}}"
            inputmode="numeric"
            minlength="5"
            maxlength="10"
            pattern="\\d{5}|\\d{10}"
            required
          />
          <div id="help-text-license_number_${entities}" class="help-text">
            Enter a 5 or 10 digit number.
          </div>
        </div>
        <div class="field-wrapper textinput">
          <div class="field-errors" style="display: none"></div>
          <label for="naic_company_code_${entities}_{{r.reg_id}}"> NAIC<sup>6</sup> Company Code </label>
          <input
            type="text"
            name="naic_company_code_${entities}_{{r.reg_id}}"
            placeholder="12345"
            class="textinput"
            id="naic_company_code_${entities}_{{r.reg_id}}"
            inputmode="numeric"
            minlength="5"
            maxlength="5"
            pattern="\\d+"
            required
          />
          <div id="help-text-naic_company_code_${entities}" class="help-text">
            Enter a 5 digit number.
          </div>
        </div>
      </div>
      <h6>
        Coverage Estimates
        <small>(Inclusive of all claims as of December 31 of previous year.)</small>
      </h6>
      <div class="field-wrapper numberinput required">
        <div class="field-errors" style="display: none"></div>
        <label for="total_covered_lives_${entities}_{{r.reg_id}}">
          Total Covered Lives<span class="asterisk">*</span>
        </label>
        <input
          type="number"
          name="total_covered_lives_${entities}_{{r.reg_id}}"
          required
          class="integerfield"
          id="total_covered_lives_${entities}_{{r.reg_id}}"
          inputmode="numeric"
          min="1"
          step="1"
        />
        <div id="help-text-total_covered_lives_${entities}" class="help-text">
        </div>
      </div>
      <div class="field-wrapper numberinput required">
        <div class="field-errors" style="display: none"></div>
        <label for="claims_encounters_volume_${entities}_{{r.reg_id}}">
          Claims and Encounters Volume<span class="asterisk">*</span>
        </label>
        <input
          type="number"
          name="claims_encounters_volume_${entities}_{{r.reg_id}}"
          required
          class="integerfield"
          id="claims_encounters_volume_${entities}_{{r.reg_id}}"
          inputmode="numeric"
          min="1"
        />
        <div id="help-text-claims_encounters_volume_${entities}" class="help-text">
        </div>
      </div>
      <div class="field-wrapper numberinput required s-affixed-input-wrapper s-affixed-input-wrapper--prefix">
        <div class="field-errors" style="display: none"></div>
        <label for="total_claims_value_${entities}_{{r.reg_id}}">
          Total Claims Value (USD<sup>7</sup>)<span class="asterisk">*</span>
        </label>
        <span class="s-affixed-input-wrapper__prefix">$</span>
        <input
          type="number"
          name="total_claims_value_${entities}_{{r.reg_id}}"
          required
          class="integerfield"
          id="total_claims_value_${entities}_{{r.reg_id}}"
          inputmode="numeric"
          step="0.01"
          min="0.01"
        />
        <div id="help-text-total_claims_value_${entities}" class="help-text">
        </div>
      </div>
      `;
      const inputs = Array.from(
        document.querySelectorAll(`
          input[name=fein_${entities}_{{r.reg_id}}],
          input[name=license_number_${entities}_{{r.reg_id}}],
          input[name=naic_company_code_${entities}_{{r.reg_id}}]
        `)
      );
      const inputListener = e => {
        inputs.filter(i => i !== e.target)
              .forEach(i => (i.required = !e.target.value.length));
      };
      inputs.forEach(i => i.addEventListener('input', inputListener));
      btnStatus();
    });

    dropEntityBtn.addEventListener("click", () => {
      document.getElementById(`entity_header_${entities}_{{r.reg_id}}`).style.display = 'none';
      let entityBlock = document.getElementById(`entity_block_${entities}_{{r.reg_id}}`);
      entityBlock.innerHTML = '';
      if (entities > 1) entities -= 1;
      btnStatus();
    });
  </script>

  <!-- To let user add and remove contacts -->
  {# RFE: Do not duplicate entity markup #}
  {# IDEA: HTML template for any instance; used by markup for 0, JS for 1+ #}
  <script id="form-add-remove-contact" type="module">
    const addContactBtn = document.getElementById("contact-add-btn-{{r.reg_id}}");
    const dropContactBtn = document.getElementById("contact-drop-btn-{{r.reg_id}}");
    const btnStatus = (() => {
      addContactBtn.disabled = ( contacts == 5 ? true : false );
      dropContactBtn.disabled = ( contacts == 1 ? true : false );
    });
    let contacts = Number("{{ r.view_modal_content.contacts|length }}");;
    btnStatus();

    addContactBtn.addEventListener("click", () => {
      if (contacts < 5) contacts += 1;
      let contactBlock = document.getElementById(`contact_block_${contacts}_{{r.reg_id}}`);
      document.getElementById(`contact_header_${contacts}_{{r.reg_id}}`).style.display = 'block';
      contactBlock.innerHTML = `
          <div class="field-wrapper textinput required">
            <div class="field-errors" style="display: none"></div>
            <label for="contact_type_${contacts}_{{r.reg_id}}"> Role<span class="asterisk">*</span> </label>
            <input
              type="text"
              name="contact_type_${contacts}_{{r.reg_id}}"
              required
              class="textinput"
              id="contact_type_${contacts}_{{r.reg_id}}"
            />
          </div>
          <div class="field-wrapper textinput required">
            <div class="field-errors" style="display: none"></div>
            <label for="contact_name_${contacts}_{{r.reg_id}}"> Name<span class="asterisk">*</span> </label>
            <input
              type="text"
              name="contact_name_${contacts}_{{r.reg_id}}"
              required
              class="textinput"
              id="contact_name_${contacts}_{{r.reg_id}}"
            />
          </div>
          <div class="field-wrapper telephoneinput required">
            <div class="field-errors" style="display: none"></div>
            <label for="contact_phone_${contacts}_{{r.reg_id}}"> Phone<span class="asterisk">*</span> </label>
            <input
              type="tel"
              name="contact_phone_${contacts}_{{r.reg_id}}"
              required
              class="telephoneinput"
              id="contact_phone_${contacts}_{{r.reg_id}}"
              inputmode="tel"
              pattern="^(\\+0?1\\s)?\\(?\\d{3}\\)?[\\s.-]\\d{3}[\\s.-]\\d{4}$"
            />
            <div id="help-text-contact_phone_${contacts}" class="help-text">
              <details>
                <summary>
                  <a
                    href="https://en.wikipedia.org/wiki/North_American_Numbering_Plan"
                    target="_blank"
                    >North American Numbering Plan</a
                  >
                  e.g. <samp>123 456-7890</samp>…
                </summary>
                <ul>
                  <li><samp>123-456-7890</samp></li>
                  <li><samp>(123) 456-7890</samp></li>
                  <li><samp>123 456 7890</samp></li>
                  <li><samp>123.456.7890</samp></li>
                  <li><samp>+1 (123) 456-7890</samp></li>
                </ul>
              </details>
            </div>
          </div>
          <div class="field-wrapper emailinput required">
            <div class="field-errors" style="display: none"></div>
            <label for="contact_email_${contacts}_{{r.reg_id}}"> Email<span class="asterisk">*</span> </label>
            <input
              type="email"
              name="contact_email_${contacts}_{{r.reg_id}}"
              autocomplete="email"
              required
              class="emailinput"
              id="contact_email_${contacts}_{{r.reg_id}}"
            />
          </div>
          <div class="field-wrapper checkboxinput">
            <div class="field-errors" style="display: none"></div>
            <input
              type="checkbox"
              name="contact_notifications_${contacts}_{{r.reg_id}}"
              class="booleanfield"
              id="contact_notifications_${contacts}_{{r.reg_id}}"
            />
            <label for="contact_notifications_${contacts}_{{r.reg_id}}">
              Select to receive system notifications
            </label>
            <div id="help-text-contact_notifications_${contacts}" class="help-text">
            </div>
          </div>
      `;
      btnStatus();
    });

    dropContactBtn.addEventListener("click", () => {
      document.getElementById(`contact_header_${contacts}_{{r.reg_id}}`).style.display = 'none';
      let contactBlock = document.getElementById(`contact_block_${contacts}_{{r.reg_id}}`);
      contactBlock.innerHTML = '';
      if (contacts > 1) contacts -= 1;
      btnStatus();
    });
  </script>

  <!-- To require at least one "types of files" choice -->
  <script id="form-types_of_files-required" type="module">
    const inputs = Array.from(
      document.querySelectorAll(`
      input[name=types_of_files_eligibility_enrollment_{{r.reg_id}}],
      input[name=types_of_files_provider_{{r.reg_id}}],
      input[name=types_of_files_medical_{{r.reg_id}}],
      input[name=types_of_files_pharmacy_{{r.reg_id}}],
      input[name=types_of_files_dental_{{r.reg_id}}]`)
    );
    const inputListener = e => {
      inputs.filter(i => i !== e.target)
            .forEach(i => (i.required = !e.target.checked));
    };

    inputs.forEach(i => i.addEventListener('input', inputListener));
  </script>

  <!-- To require at least one "entity" identifier value -->
  <script id="form-entity_id-required" type="module">
    const inputs = Array.from(
      document.querySelectorAll('input[name=fein_{{r.reg_id}}], input[name=license_number_{{r.reg_id}}], input[name=naic_company_code_{{r.reg_id}}]')
    );
    const inputListener = e => {
      inputs.filter(i => i !== e.target)
            .forEach(i => (i.required = !e.target.value.length));
    };

    inputs.forEach(i => i.addEventListener('input', inputListener));
  </script>
</aside>

